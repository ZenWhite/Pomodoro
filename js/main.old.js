"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}window.addEventListener("DOMContentLoaded",function(){var t=document.querySelectorAll(".popup-btn"),e=document.querySelectorAll(".popup"),i=document.querySelector(".settings-btn"),n=document.getElementById("work"),s=document.getElementById("chill"),o=new(function(){function e(t){_classCallCheck(this,e),this.root=document.querySelector(t),this.txt=document.getElementById("time"),this.isWork=!0,this.loop=null,this.total=0,this.minutes=0,this.seconds=0,this.pomodoro=0,this.workTime=parseInt(n.value),this.chillTime=parseInt(s.value),this.setListeners()}return _createClass(e,[{key:"render",value:function(t,e){this.txt.textContent="".concat(t,":").concat(e<10?"0"+e:e),document.querySelector(".scores").textContent=this.pomodoro}},{key:"setListeners",value:function(){var e=this;this.root.addEventListener("click",function(t){t.preventDefault(),"play"==t.target.id&&e.setTimer(),"stop"==t.target.id&&(e.stopTimer(),t.target.classList.add("active-btn"),setTimeout(function(){return t.target.id="return"},0)),"return"==t.target.id&&(e.returnTimer(),t.target.classList.remove("active-btn"),setTimeout(function(){return t.target.id="stop"},0))})}},{key:"getTime",value:function(t){var e=new Date;return t?e.setMinutes(e.getMinutes()+t):(e.setMinutes(e.getMinutes()+this.minutes),e.setSeconds(e.getSeconds()+this.seconds)),e}},{key:"setTimer",value:function(t){var e=this;this.root.classList.add("active-timer");var i=this.getTime(this.isWork?this.workTime:this.chillTime);t&&(i=this.getTime()),this.updateTimer(i),this.loop=setInterval(function(){e.updateTimer(i)},1e3)}},{key:"updateTimer",value:function(t){this.total=Date.parse(t)-Date.parse(new Date),this.minutes=Math.floor(this.total/1e3/60%60),this.seconds=Math.floor(this.total/1e3%60),this.isTimeEnd(),this.render(this.minutes,this.seconds)}},{key:"onTimerAndHandler",value:function(){this.isWork?(this.pomodoro++,this.notifSet("Время отдыха вышло","Вернёмся к работе!")):this.notifSet("Время работы вышло","Дай себе отдохнуть и сделай перерыв")}},{key:"stopTimer",value:function(){clearInterval(this.loop),this.loop=null}},{key:"returnTimer",value:function(){this.setTimer(!0)}},{key:"isTimeEnd",value:function(){0===this.total&&(this.reset(),this.isWork=!this.isWork,this.setTimer(),this.onTimerAndHandler(),document.body.classList.toggle("chill"))}},{key:"reset",value:function(){this.stopTimer(),this.total=0,this.workTime=+n.value,this.chillTime=+s.value,this.root.classList.remove("active-timer"),this.root.querySelector(".stop-btn").classList.remove("active-btn")}},{key:"notifyMe",value:function(t,e){new Notification(t,{tag:"ache-mail",body:e,icon:"https://www.pinclipart.com/picdir/middle/82-821023_youtube-bell-png-youtube-notification-bell-png-clipart.png"})}},{key:"notifSet",value:function(e,i){"Notification"in window?"granted"===Notification.permission?this.notifyMe(e,i):"denied"!==Notification.permission&&Notification.requestPermission(function(t){"permission"in Notification||(Notification.permission=t),"granted"===t&&this.notifyMe(e,i)}):alert("Ваш браузер не поддерживает уведомления."),new Audio("audio/notification.mp3").play()}}]),e}())(".timer");function r(t){t.preventDefault(),document.querySelector(".".concat(this.dataset.popup)).classList.remove("hide")}function a(t){t.preventDefault(),(t.target.classList.contains("popup")||t.target.closest(".close"))&&this.classList.add("hide")}i.addEventListener("click",function(){this.closest(".popup").classList.add("hide"),n.value<1&&(n.value=1);s.value<1&&(s.value=1);o.reset(),document.body.classList.remove("chill")}),t.forEach(function(t){t.addEventListener("click",r)}),e.forEach(function(t){t.addEventListener("click",a)})});